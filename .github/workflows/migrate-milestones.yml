name: Sync Milestones and Issues Bi-directionally

on:
  workflow_dispatch:
    inputs:
      source_owner:
        description: 'Source repository owner'
        required: true
        default: 'MichelleTsai'
      source_repo:
        description: 'Source repository name'
        required: true
        default: 'UI-Interface'
      target_owner:
        description: 'Target repository owner'
        required: true
        default: 'MichelleTsai'
      target_repo:
        description: 'Target repository name'
        required: true
        default: 'Centralized-project'
  schedule:
    # Run sync every 6 hours
    - cron: '0 */6 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests

      - name: Sync milestones and issues bidirectionally
        env:
          GITHUB_TOKEN: ${{ secrets.MILESTONE_TOKEN }}
          SOURCE_OWNER: ${{ github.event.inputs.source_owner || 'MichelleTsai' }}
          SOURCE_REPO: ${{ github.event.inputs.source_repo || 'UI-Interface' }}
          TARGET_OWNER: ${{ github.event.inputs.target_owner || 'MichelleTsai' }}
          TARGET_REPO: ${{ github.event.inputs.target_repo || 'Centralized-project' }}
        run: python sync_milestones_and_issues.py

      - name: Commit mappings
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .github/issue-mappings.json 2>/dev/null || true
          git commit -m "Update issue mappings from sync" 2>/dev/null || true
          git push 2>/dev/null || true
